platform:
  - x64
environment:
  matrix:
    # Stuck on 3.9 until VTK releases a 3.10 binary
    - QT_PIP: PyQt5
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2022
      PYTHON: "C:\\Python39-x64"
      PYTHON_VERSION: "3.9.x"
      PYTHON_ARCH: "64"
    - QT_PIP: PyQt6
      APPVEYOR_BUILD_WORKER_IMAGE: macOS
      TOXENV: py39
    - QT_PIP: PySide2
      APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu2004
      TOXENV: py39
      DISPLAY: ":99"
    - QT_PIP: PySide6
      APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu2004
      TOXENV: py39
      DISPLAY: ":99"
for:
  -
    matrix:
      only:
        - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2022
    install:
      - "git clone --depth 1 https://github.com/pyvista/gl-ci-helpers.git"
      - "powershell gl-ci-helpers/appveyor/install_opengl.ps1"
  -
    matrix:
      only:
        - APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu2004
    install:
      - ./tools/setup_xvfb.sh

build: false

build_script:
  - "python -m pip install --upgrade pip setuptools wheel"
  - "python -m pip install --upgrade --only-binary=\"numpy,scipy,matplotlib,pandas,numba,vtk,dipy\" -r requirements.txt -r requirements_testing.txt codecov"
  # python -m pip uninstall PyQt5 PyQt5-sip
  # ps: python -m pip install --upgrade --pre $env:QT_PIP
  - "python setup.py develop"
  - "mne sys_info"
  - "python -c \"import mne; mne.datasets.testing.data_path(verbose=True)\""

test_script:
  - "pytest -m \"not ultraslowtest\" mne/gui mne/viz"

on_success:
  - "codecov"
